<link rel="import" href="../polymer/polymer.html">
<script type="text/javascript" src="../sockjs/sockjs.js"></script>
<script type="text/javascript" src="../vertxbus/vertxbus.js"></script>

<polymer-element name="vertx-eventbus" attributes="url pingInterval registerHandlers onopen onclose autoReconnect">
    <script>
    Polymer({
      ready: function () {
        var self = this;
        self.isConnected = false;

        var eb = new vertx.EventBus(self.url, {vertxbus_ping_interval: self.pingInterval});
        eb.onopen = function() {
            self.isConnected = true;
            self.onopen();
            self.registerHandlers.forEach(function(regHandler) {
                eb.registerHandler(regHandler.address, regHandler.function);
            });
        };

        eb.onclose = function() {
            self.isConnected = false;
            self.registerHandlers.forEach(function(regHandler) {
                eb.unregisterHandler(regHandler.address, regHandler.function);
            });
            self.onclose();
        };
      }
    });
  </script>
</polymer-element>
